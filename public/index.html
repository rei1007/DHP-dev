<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大学杯 | 大学生のためのスプラトゥーンコミュニティ大会</title>
    <meta name="description" content="大学杯(Inkollege Student Cup)は、全国の大学生・大学院生・高専生が集うスプラトゥーンのコミュニティ大会。">
    <meta name="keywords" content="大学杯,スプラトゥーン,大学生,eスポーツ,Splatoon,Inkollege,大会">
    <link rel="icon" href="icon/favicon.ico">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@500;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&family=Oswald:wght@500&display=swap"
        rel="stylesheet">

    <style>
        /* --- Design System --- */
        :root {
            /* Colors */
            --c-bg: #f8f9fa;
            --c-surface: #ffffff;
            --c-text-main: #2d3748;
            --c-text-muted: #718096;
            --c-primary: #1a365d;
            --c-accent: #00A4C2;
            --c-gold: #b7791f;

            --border: 1px solid #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);

            /* Fonts */
            --f-sans: 'Zen Kaku Gothic New', sans-serif;
            --f-serif: 'Shippori Mincho', serif;
            --f-eng: 'Oswald', sans-serif;

            --sp-container: max(16px, 4vw);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 15px;
        }

        /* Mobile Base */
        body {
            background-color: var(--c-bg);
            color: var(--c-text-main);
            font-family: var(--f-sans);
            line-height: 1.8;
            overflow-x: hidden;
        }

        @media (min-width: 768px) {
            html {
                font-size: 16px;
            }
        }

        a {
            color: inherit;
            text-decoration: none;
            transition: 0.2s ease;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .container {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 var(--sp-container);
        }

        .section {
            padding: 60px 0;
            position: relative;
        }

        /* Reduced Mobile Padding */
        @media (min-width: 768px) {
            .section {
                padding: 100px 0;
            }
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title {
            font-family: var(--f-serif);
            font-size: 1.8rem;
            color: var(--c-primary);
            margin-bottom: 12px;
            display: inline-block;
            position: relative;
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 2.2rem;
                margin-bottom: 16px;
            }
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: var(--c-accent);
            margin: 10px auto 0;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: var(--border);
        }

        .header-inner {
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            height: 100%;
        }

        .brand img {
            height: 60px;
        }

        /* ロゴのみ表示 */

        .nav-desk {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .nav-link {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--c-text-main);
        }

        .nav-link:hover {
            color: var(--c-primary);
        }

        .btn-dash-nav {
            padding: 8px 20px;
            border-radius: 4px;
            background: var(--c-primary);
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-block;
        }

        .btn-dash-nav:hover {
            background: #102a4e;
            transform: translateY(-1px);
        }

        .ham-btn {
            display: none;
            cursor: pointer;
        }

        .ham-btn span {
            width: 24px;
            height: 2px;
            background: var(--c-primary);
            display: block;
            margin: 6px 0;
        }

        /* Hero */
        .hero {
            height: 100svh;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            color: white;
            overflow: hidden;
        }

        .hero-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.6);
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 900px;
            padding-bottom: 60px;
        }

        .hero-surtitle {
            font-family: var(--f-eng);
            font-size: 1.2rem;
            letter-spacing: 0.2em;
            color: var(--c-accent);
            display: block;
            margin-bottom: 24px;
            text-transform: uppercase;
        }

        .hero-title {
            font-family: var(--f-serif);
            font-size: clamp(2.5rem, 7vw, 5rem);
            line-height: 1.2;
            margin-bottom: 32px;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .hero-desc {
            font-size: clamp(1rem, 2vw, 1.2rem);
            margin-bottom: 48px;
            opacity: 0.9;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* News Bridge */
        .news-bridge {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100%;
            z-index: 10;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .news-card-hero {
            background: rgba(26, 54, 93, 0.9);
            /* Dark Navy semi-transparent */
            backdrop-filter: blur(4px);
            border-left: 4px solid var(--c-accent);
            max-width: 900px;
            margin: 0 auto;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            padding: 12px 20px;
            gap: 15px;
            color: white;
            /* White text for better visibility */
            transition: transform 0.2s;
        }

        .news-card-hero:hover {
            transform: translateY(-2px);
            background: rgba(26, 54, 93, 1);
        }

        .badge-news-hero {
            background: var(--c-accent);
            color: white;
            padding: 3px 10px;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: 99px;
            font-family: var(--f-eng);
            white-space: nowrap;
        }

        .news-hero-title {
            flex: 1;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.95rem;
        }

        @media (max-width: 600px) {
            .news-card-hero {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
                padding: 12px 16px;
            }

            .news-hero-title {
                white-space: normal;
                overflow: visible;
                line-height: 1.4;
            }
        }

        /* Latest Tournaments (Grid) */
        .latest-section {
            padding-top: 180px;
            padding-bottom: 80px;
            background: var(--c-bg);
        }

        .tour-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .tour-card {
            background: var(--c-surface);
            border-radius: 8px;
            overflow: hidden;
            border: var(--border);
            transition: 0.3s;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
        }

        .tour-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--c-primary);
        }

        .tour-status {
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            text-align: center;
        }

        .status-open {
            background: var(--c-accent);
        }

        .status-upcoming {
            background: var(--c-gold);
        }

        .status-closed {
            background: var(--c-text-muted);
        }

        .tour-body {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .tour-title {
            font-family: var(--f-serif);
            font-size: 1.25rem;
            color: var(--c-primary);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .tour-meta {
            font-size: 0.9rem;
            color: var(--c-text-muted);
            margin-bottom: 15px;
        }

        .tour-meta div {
            display: flex;
            gap: 8px;
            margin-bottom: 4px;
            align-items: center;
        }

        /* Schedule */
        .timeline-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            margin-top: 40px;
        }

        .timeline-line {
            position: absolute;
            left: 24px;
            top: 20px;
            bottom: 20px;
            width: 2px;
            background: #cbd5e0;
        }

        .timeline-item {
            position: relative;
            padding-left: 80px;
            margin-bottom: 60px;
        }

        .timeline-dot {
            position: absolute;
            left: 17px;
            top: 0;
            width: 16px;
            height: 16px;
            background: white;
            border: 3px solid var(--c-primary);
            border-radius: 50%;
            z-index: 1;
        }

        .timeline-date {
            font-family: var(--f-serif);
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--c-accent);
            margin-bottom: 8px;
        }

        .timeline-content h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--c-primary);
        }

        .timeline-content p {
            color: var(--c-text-muted);
        }

        .tag {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            background: #edf2f7;
            color: var(--c-text-muted);
            font-weight: 500;
            margin-left: 8px;
        }

        .tag.main {
            color: var(--c-primary);
            background: rgba(26, 54, 93, 0.1);
        }

        /* News List Section */
        .news-list-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            border: var(--border);
            overflow: hidden;
        }

        .news-item {
            display: flex;
            gap: 15px;
            padding: 20px;
            border-bottom: 1px solid #edf2f7;
            align-items: flex-start;
            text-align: left;
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-item:hover {
            background: #f8fafc;
        }

        .news-meta {
            display: flex;
            flex-direction: column;
            min-width: 100px;
            gap: 4px;
        }

        .news-date {
            color: var(--c-text-muted);
            font-family: var(--f-eng);
            font-size: 0.85rem;
        }

        .news-cat {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            background: #edf2f7;
            color: var(--c-text-muted);
            width: fit-content;
        }

        .news-item-title {
            font-weight: 500;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--c-text-main);
        }

        @media (max-width: 600px) {
            .news-item {
                flex-direction: column;
                gap: 8px;
                padding: 15px;
            }

            .news-meta {
                flex-direction: row;
                align-items: center;
                width: 100%;
            }
        }

        /* SNS Section */
        .sns-section {
            background: white;
            padding: 80px 0;
            text-align: center;
        }

        .sns-grid {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 40px;
        }

        .sns-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: var(--c-primary);
        }

        .sns-icon-box {
            width: 60px;
            height: 60px;
            background: #f7fafc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            color: var(--c-text-main);
        }

        .sns-item:hover .sns-icon-box {
            background: var(--c-primary);
            color: white;
            transform: scale(1.1);
        }

        /* Footer */
        .footer {
            background: #1a202c;
            color: #cbd5e0;
            padding: 60px 0;
            text-align: center;
        }

        .footer-logo {
            font-family: var(--f-serif);
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: white;
            font-weight: 700;
        }

        .footer-links {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            font-size: 0.9rem;
            color: #a0aec0;
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        /* CTA Bar */
        .cta-bar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border: 1px solid var(--c-primary);
            border-radius: 8px;
            padding: 20px;
            z-index: 900;
            box-shadow: var(--shadow-lg);
            width: 280px;
            transition: 0.3s;
        }

        .cta-bar.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .btn-cta {
            background: var(--c-accent);
            color: white;
            display: block;
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            font-weight: 700;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .nav-desk {
                display: none;
            }

            .ham-btn {
                display: block;
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .news-card-hero {
                flex-direction: column;
                align-items: flex-start;
                margin: 0 20px;
                padding: 15px;
            }

            .tour-grid {
                grid-template-columns: 1fr;
            }

            .sns-grid {
                flex-direction: column;
                gap: 30px;
            }

            .latest-section {
                padding-top: 200px;
            }

            /* Mobile Padding for overlap */
        }
    </style>
    <style>
        /* Date Emphasis */
        .tour-date-stress {
            font-weight: 800;
            color: var(--c-primary);
            font-size: 1.25rem;
            background: #bee3f8;
            /* 薄い青背景 */
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .tour-entry-stress {
            color: #e53e3e;
            font-weight: 700;
        }

        /* News Mobile */
        @media (max-width: 767px) {
            .news-bridge {
                top: auto;
                bottom: 85px;
                padding: 0 15px;
            }

            .news-card-hero {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
                padding: 12px 15px;
            }

            .news-card-hero .news-date {
                font-size: 0.75rem;
                color: #a0aec0;
            }

            .news-card-hero .news-title {
                font-size: 0.9rem;
                margin: 0;
            }

            .section {
                padding: 50px 0;
            }
        }

        /* Result Modal */
        .res-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .res-modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .res-modal-content {
            background: white;
            width: 100%;
            max-width: 500px;
            border-radius: 12px;
            padding: 25px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .res-modal-overlay.active .res-modal-content {
            transform: translateY(0);
        }

        .res-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            color: #718096;
            background: none;
            border: none;
            cursor: pointer;
        }

        .mob-dash-btn {
            display: none;
            margin-left: auto;
            margin-right: 15px;
            font-size: 0.8rem;
            padding: 6px 12px;
            border-radius: 4px;
            background: var(--c-primary);
            color: white;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .mob-dash-btn {
                display: inline-block;
            }
        }

        .res-img-box {
            width: 100%;
            aspect-ratio: 16/9;
            background: #edf2f7;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
        }

        .res-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .res-team-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--c-primary);
            margin-bottom: 5px;
        }

        .res-univ-info {
            font-size: 0.9rem;
            color: #718096;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .res-members {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }

        .res-mem-item {
            background: #f7fafc;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .res-mem-icon {
            width: 20px;
            height: 20px;
            background: #cbd5e0;
            border-radius: 50%;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <header class="header">
        <div class="container header-inner">
            <a href="/" class="brand">
                <img src="icon/大学杯ロゴ.png" alt="大学杯">
            </a>
            <nav class="nav-desk">
                <a href="#latest" class="nav-link">直近の大会</a>
                <a href="#schedule" class="nav-link">年間スケジュール</a>
                <a href="news.html" class="nav-link">お知らせ</a>
                <a href="#sns" class="nav-link">SNS</a>
                <a href="admin.html" class="btn-dash-nav">ダッシュボード</a>
            </nav>

            <!-- Mobile Dashboard Button -->
            <a href="admin.html" class="mob-dash-btn">ダッシュボード</a>

            <div class="ham-btn" id="hamBtn"><span></span><span></span><span></span></div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobMenu"
        style="position:fixed; inset:0; background:white; z-index:999; display:none; flex-direction:column; justify-content:center; align-items:center; gap:2rem;">
        <a href="#latest" class="nav-link" style="font-size:1.2rem;">直近の大会</a>
        <a href="#schedule" class="nav-link" style="font-size:1.2rem;">年間スケジュール</a>
        <a href="news.html" class="nav-link" style="font-size:1.2rem;">お知らせ</a>
        <a href="#sns" class="nav-link" style="font-size:1.2rem;">SNS</a>
        <button id="closeMob" style="background:none; border:none; color:#2d3748; font-size:2rem;">&times;</button>
    </div>

    <!-- Hero -->
    <section class="hero">
        <video class="hero-video" autoplay muted loop playsinline poster="icon/ogp.png">
            <source src="icon/スライドショー.mp4" type="video/mp4">
        </video>
        <div class="hero-overlay"></div>
        <div class="container hero-content">
            <span class="hero-surtitle">Inkollege Student Cup</span>
            <h1 class="hero-title">青春で<br>塗り替えろ</h1>
            <p class="hero-desc">大学生のためのスプラトゥーン大会</p>
            <a href="#latest" class="btn-dash-nav"
                style="background:white; color:var(--c-primary); padding:14px 40px; font-weight:700;">大会に参加する</a>
        </div>

        <div class="news-bridge">
            <div class="container" id="heroNewsContainer">
                <!-- Loaded by JS -->
            </div>
        </div>
    </section>

    <!-- Latest Tournaments (Grid View) -->
    <section id="latest" class="latest-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Tournament List</h2>
                <p class="section-desc">現在受付中および直近開催された大会</p>
            </div>

            <div class="tour-grid">
                <!-- Data loaded by JS -->
            </div>

            <div style="text-align:center; margin-top:40px;">
                <a href="/tournaments" class="btn-dash-nav"
                    style="background:transparent; color:var(--c-text-muted); border:1px solid #cbd5e0;">全ての過去大会を見る</a>
            </div>
        </div>
    </section>

    <!-- Schedule -->
    <section id="schedule" class="section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Annual Schedule</h2>
                <p>大学杯主催大会の年間スケジュール</p>
            </div>
            <div class="timeline-container">
                <div class="timeline-line"></div>
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">5月・新歓</div>
                    <div class="timeline-content">
                        <h3>大学杯Fresh<span class="tag tag-new">Newcomer</span></h3>
                        <p>新入生歓迎大会。新入生1名以上の参加が必須。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">8月・夏</div>
                    <div class="timeline-content">
                        <h3>大学杯 夏の陣 <span class="tag tag-main">Main</span></h3>
                        <p>最大規模の夏フェス。最大規模のガチエリア大会である「大学杯(無印)」、初級者向けナワバリバトル大会の「大学杯0(ヌル)」、そして出場制限なしの上級者向けガチエリア大会の「大学杯+(プラス)」、3大会開催。
                        </p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">11月・冬</div>
                    <div class="timeline-content">
                        <h3>大学杯真打 <span class="tag tag-gold">Invite Only</span></h3>
                        <p>サークル選抜チームが戦う頂上決戦。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">3月・春</div>
                    <div class="timeline-content">
                        <h3>大学杯 春の陣 <span class="tag tag-main">Main</span></h3>
                        <p>年度末の総決算。夏と同じく無印、0、+の3大会開催。</p>
                    </div>
                </div>
            </div>

            <div
                style="text-align:center; margin-top:50px; padding:20px; border:1px dashed #cbd5e0; border-radius:8px;">
                <h4 style="color:var(--c-primary); margin-bottom:5px;">その他の大会</h4>
                <p style="font-size:0.9rem; color:var(--c-text-muted);">
                    ナワバリバトルのガチ大会「大学杯θ(シータ)」やイカップル大会の「大学杯W」、サーモンラン大会の「大学鮭杯」なども不定期開催！今後も新しい大会を企画していきます！最新の大会情報はXアカウントをご確認ください。
                </p>
            </div>
        </div>
    </section>

    <!-- News List Section (Independent) -->
    <section id="news" class="section" style="background:#f1f5f9;">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">News</h2>
                <p>最新のお知らせ</p>
            </div>

            <div class="news-list-container" id="newsList">
                <!-- Loaded by JS -->
            </div>

            <div style="text-align:center; margin-top:30px;">
                <a href="news.html" class="btn-dash-nav"
                    style="background:transparent; color:var(--c-primary); border:1px solid currentColor;">お知らせ一覧へ</a>
            </div>
        </div>
    </section>

    <!-- SNS Section (Independent) -->
    <section id="sns" class="sns-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Follow Us</h2>
                <p class="section-desc">最新情報は公式SNSでチェック</p>
            </div>
            <div class="sns-grid">
                <a href="https://x.com/daigakuhai" target="_blank" class="sns-item">
                    <div class="sns-icon-box">
                        <!-- X Icon -->
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                        </svg>
                    </div>
                    <span>Official X</span>
                </a>
                <a href="https://youtube.com" target="_blank" class="sns-item">
                    <div class="sns-icon-box">
                        <!-- YT Icon Fixed -->
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
                        </svg>
                    </div>
                    <span>YouTube</span>
                </a>
                <a href="https://discord.gg/example" target="_blank" class="sns-item">
                    <div class="sns-icon-box">
                        <!-- Discord Icon (generic) -->
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                            </path>
                        </svg>
                    </div>
                    <span>Discord</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="footer" class="footer">
        <div class="container">
            <div class="footer-logo">大学杯</div>
            <p>Inkollege Student Cup</p>

            <div class="footer-links">
                <a href="privacy.html">利用規約・プライバシーポリシー</a>
                <a href="admin.html">運営ダッシュボード</a>
            </div>

            <p style="margin-top:40px; font-size:0.8rem; color:#718096;">&copy; 2025 Inkollege Student Cup.</p>
        </div>
    </footer>

    <!-- Result Modal -->
    <div id="resModal" class="res-modal-overlay">
        <div class="res-modal-content">
            <button class="res-close" onclick="closeResModal()">×</button>
            <div id="resImgArea" class="res-img-box">
                <!-- Image or Placeholder -->
                <span>No Image</span>
            </div>
            <div style="text-align:center;">
                <span
                    style="background:#FFD700; color:#333; padding:2px 10px; border-radius:20px; font-size:0.8rem; font-weight:bold; letter-spacing:1px; margin-bottom:10px; display:inline-block;">WINNER</span>
                <h3 id="resTeam" class="res-team-name">Team Name</h3>
                <div class="res-univ-info">
                    <span id="resUniv">University</span>
                    <span style="opacity:0.5;">/</span>
                    <span id="resCircle">Circle</span>
                </div>
            </div>
            <div id="resMembers" class="res-members">
                <!-- Members injected by JS -->
            </div>
            <div id="resCastArea" style="margin:20px 0; padding-top:10px; border-top:1px solid #eee; font-size:0.9rem;">
            </div>
            <a id="resLink" href="#" target="_blank" class="btn-cta"
                style="width:100%; text-align:center; display:block; background:var(--c-primary);">結果の詳細を見る (X)</a>
            <a id="resArchiveBtn" href="#" target="_blank" class="btn-dash-nav"
                style="width:100%; text-align:center; display:none; margin-top:10px; background:#edf2f7; color:#718096; border:none;">アーカイブ動画を見る</a>
        </div>
    </div>

    <!-- Floating CTA -->
    <div id="ctaBar" class="cta-bar hidden">
        <!-- JS injected -->
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy, limit, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCaVNHlJBoWcn9BQd7jPFtELxsOLHCZdv0",
            authDomain: "daigakuhai.firebaseapp.com",
            projectId: "daigakuhai",
            storageBucket: "daigakuhai.firebasestorage.app",
            messagingSenderId: "1003642519018",
            appId: "1:1003642519018:web:2700931b9f1c451ec74693"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let tournamentsData = [];

        async function loadTournaments() {
            const tourGrid = document.querySelector('.tour-grid');
            if (!tourGrid) return;

            try {
                // Client-side sort
                const q = query(collection(db, "tournaments"));
                const snapshot = await getDocs(q);

                if (snapshot.empty) { return; }

                tournamentsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Global Sort for consistency (Status -> Date Desc)
                const statusOrder = { 'open': 1, 'upcoming': 2, 'closed': 3 };
                tournamentsData.sort((a, b) => {
                    const sA = statusOrder[a.status] || 99;
                    const sB = statusOrder[b.status] || 99;
                    if (sA !== sB) return sA - sB;
                    // Date Desc
                    const dA = a.eventDate ? new Date(a.eventDate).getTime() : 0;
                    const dB = b.eventDate ? new Date(b.eventDate).getTime() : 0;
                    return dB - dA;
                });

                // Filtering for Display
                // Open & Upcoming: SHOW ALL
                // Closed: Show limited number on mobile, more on desktop
                const openTours = tournamentsData.filter(t => t.status === 'open');
                const upcomingTours = tournamentsData.filter(t => t.status === 'upcoming');
                const closedTours = tournamentsData.filter(t => t.status !== 'open' && t.status !== 'upcoming');

                const isMobile = window.innerWidth < 768;
                const closedLimit = isMobile ? 1 : 4;

                // Combine
                const displayList = [
                    ...openTours,
                    ...upcomingTours,
                    ...closedTours.slice(0, closedLimit)
                ];

                let html = '';
                displayList.forEach(t => {
                    let statusClass = 'status-closed';
                    let statusText = '終了';
                    let borderColor = 'var(--border)';

                    if (t.status === 'open') {
                        statusClass = 'status-open';
                        statusText = 'エントリー受付中';
                        borderColor = 'var(--c-accent)';
                    } else if (t.status === 'upcoming') {
                        statusClass = 'status-upcoming';
                        statusText = '開催予定';
                    }

                    // Date
                    let dateDisplay = '-';
                    if (t.eventDate) {
                        const d = new Date(t.eventDate);
                        const y = d.getFullYear();
                        const m = ('0' + (d.getMonth() + 1)).slice(-2);
                        const day = ('0' + d.getDate()).slice(-2);
                        dateDisplay = `${y}.${m}.${day}`;
                    }

                    // Entry Period
                    let entryDisplay = '';
                    if (t.status === 'open' && t.entryEnd) {
                        const d = new Date(t.entryEnd);
                        const m = d.getMonth() + 1;
                        const day = d.getDate();
                        const hours = ('0' + d.getHours()).slice(-2);
                        const mins = ('0' + d.getMinutes()).slice(-2);
                        entryDisplay = `~${m}/${day} ${hours}:${mins}`;
                    }

                    const rulesStr = (t.rules && t.rules.length > 0) ? t.rules.join(' / ') : 'ルール未定';
                    const dateIcon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>`;
                    const flagIcon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line></svg>`;

                    // Cast Info (List)
                    let castInfo = '';
                    const casterName = (t.caster && t.caster.name) ? t.caster.name : '未定';
                    // No icon if missing
                    const castIcon = (t.caster && t.caster.icon) ? `<img src="${t.caster.icon}" style="width:24px;height:24px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:5px;">` : '';

                    const comName = (t.commentator && t.commentator.name) ? t.commentator.name : '未定';
                    const comIcon = (t.commentator && t.commentator.icon) ? `<img src="${t.commentator.icon}" style="width:24px;height:24px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:5px;">` : '';

                    castInfo += `<div style="font-size:0.85rem; margin-top:4px; color:#4a5568; display:flex; align-items:center;">
                        <span style="font-weight:bold; margin-right:5px;">実況:</span> ${castIcon}${casterName}
                    </div>`;
                    castInfo += `<div style="font-size:0.85rem; margin-top:2px; color:#4a5568; display:flex; align-items:center;">
                         <span style="font-weight:bold; margin-right:5px;">解説:</span> ${comIcon}${comName}
                    </div>`;

                    // Action
                    let actionHtml = '';
                    if (t.status === 'open') {
                        actionHtml = `<a href="javascript:void(0)" onclick="location.href='entry.html'" class="btn-dash-nav" style="width:100%; text-align:center; background:var(--c-accent); color:white; border:none; display:block;">詳細・エントリー</a>`;
                    } else if (t.status === 'upcoming') {
                        actionHtml = `<span style="color:var(--c-text-muted); font-size:0.9rem;">情報は後日公開</span>`;
                    } else {
                        // モーダルを開く条件：Win情報があるか
                        if (t.winner?.team || t.winner?.url) {
                            actionHtml = `<button onclick="openResultModal('${t.id}');" class="btn-dash-nav" style="width:100%; background:white; color:var(--c-primary); border:1px solid var(--c-primary); cursor:pointer;">結果を見る</button>`;
                        } else {
                            actionHtml = `<span style="color:var(--c-text-muted); font-size:0.9rem;">終了しました</span>`;
                        }
                    }

                    html += `
                    <div class="tour-card" style="border-color:${borderColor};">
                        <div class="tour-status ${statusClass}">${statusText}</div>
                        <div class="tour-body">
                            <div>
                                <h3 class="tour-title">${t.name}</h3>
                                <div class="tour-meta">
                                    <div title="開催日" class="${(t.status === 'open' || (t.status === 'upcoming' && t.eventDate)) ? 'tour-date-stress' : ''}">${dateIcon} ${dateDisplay}</div>
                                    <div title="ルール">${flagIcon} ${rulesStr}</div>
                                </div>
                                ${entryDisplay ? `<div style="margin-top:5px;"><span style="font-size:0.8rem; background:#edf2f7; color:#4a5568; padding:2px 8px; border-radius:4px;">エントリー <span class="tour-entry-stress">${entryDisplay}</span></span></div>` : ''}
                                ${castInfo}
                            </div>
                            <div style="margin-top:10px;">${actionHtml}</div>
                        </div>
                    </div>
                    `;
                });

                tourGrid.innerHTML = html;

                // CTAバーの更新
                updateCtaBar(tournamentsData);

            } catch (e) {
                console.error("Error loading tournaments:", e);
                if (tourGrid) tourGrid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color:#e53e3e;">大会情報の読み込みに失敗しました。</div>';
            }
        }

        function updateCtaBar(data) {
            const ctaBar = document.getElementById('ctaBar');
            if (!ctaBar) return;

            // Find Open tournaments
            const openTours = data.filter(t => t.status === 'open');

            let targetTour = null;

            if (openTours.length > 0) {
                // Sort by entryEnd ASC
                openTours.sort((a, b) => {
                    const tA = a.entryEnd ? new Date(a.entryEnd).getTime() : 9999999999999;
                    const tB = b.entryEnd ? new Date(b.entryEnd).getTime() : 9999999999999;
                    return tA - tB;
                });
                targetTour = openTours[0];
            }

            if (targetTour) {
                let periodStr = '';
                if (targetTour.entryEnd) {
                    const d = new Date(targetTour.entryEnd);
                    const m = d.getMonth() + 1;
                    const day = d.getDate();
                    const hours = ('0' + d.getHours()).slice(-2);
                    const mins = ('0' + d.getMinutes()).slice(-2);
                    periodStr = `~${m}/${day} <span style="font-size:0.85em">(${hours}:${mins})</span>`;
                }

                ctaBar.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                        <span style="font-weight:700; color:var(--c-primary);">エントリー受付中</span>
                        <span style="font-size:0.9rem; color:#e53e3e; font-weight:bold;">${periodStr}</span>
                    </div>
                    <div style="font-size:0.9rem; margin-bottom:10px;">${targetTour.name}</div>
                    <a href="entry.html" class="btn-cta">エントリー</a>
                `;
                ctaBar.style.display = 'block'; // Data exists -> Show (Observer handles hidden class)
            } else {
                ctaBar.style.display = 'none'; // No data -> Hide
            }
        }

        // Modal Logic
        window.openResultModal = (id) => {
            const t = tournamentsData.find(x => x.id === id);
            if (!t || (!t.winner && !t.caster)) return; // winnerなくてもcasterあれば出す？一応winnerチェック緩める

            const w = t.winner || {};
            const modal = document.getElementById('resModal');
            document.getElementById('resTeam').textContent = w.team || 'Unknown Team';
            document.getElementById('resUniv').textContent = w.univ || '-';
            document.getElementById('resCircle').textContent = w.circle || '-';

            // Image
            const imgArea = document.getElementById('resImgArea');
            if (w.image) {
                imgArea.innerHTML = `<img src="${w.image}" alt="Winner Image">`;
            } else {
                imgArea.innerHTML = `<span>No Image</span>`;
            }

            // Members
            const memArea = document.getElementById('resMembers');
            memArea.innerHTML = '';
            if (w.members && w.members.length > 0) {
                w.members.forEach(m => {
                    memArea.innerHTML += `
                        <div class="res-mem-item">
                            <div class="res-mem-icon"></div>
                            ${m}
                        </div>
                    `;
                });
            } else {
                memArea.innerHTML = `<span style="color:#a0aec0; grid-column:span 2;">メンバー情報なし</span>`;
            }

            // Cast Info
            const castArea = document.getElementById('resCastArea');
            let castHtml = '';

            // Caster
            if (t.caster && t.caster.name) {
                const icon = t.caster.icon ? `<img src="${t.caster.icon}" style="width:24px; height:24px; border-radius:50%; object-fit:cover; margin-right:5px;">` : '';
                castHtml += `<div style="display:flex; align-items:center; margin-bottom:5px;"><strong>実況:</strong> <span style="margin-left:8px; display:flex; align-items:center;">${icon}${t.caster.name}</span></div>`;
            }
            // Commentator
            if (t.commentator && t.commentator.name) {
                const icon = t.commentator.icon ? `<img src="${t.commentator.icon}" style="width:24px; height:24px; border-radius:50%; object-fit:cover; margin-right:5px;">` : '';
                castHtml += `<div style="display:flex; align-items:center; margin-bottom:5px;"><strong>解説:</strong> <span style="margin-left:8px; display:flex; align-items:center;">${icon}${t.commentator.name}</span></div>`;
            }

            // Operator
            if (t.operator) {
                castHtml += `<div style="margin-bottom:5px;"><strong>配信:</strong> ${t.operator}</div>`;
            }

            // License
            if (t.license) {
                castHtml += `<div style="margin-top:10px; font-size:0.75rem; color:#a0aec0;">許諾番号: ${t.license}</div>`;
            }

            castArea.innerHTML = castHtml;

            // Link
            const linkBtn = document.getElementById('resLink');
            if (w.url) {
                linkBtn.href = w.url;
                linkBtn.style.display = 'block';
            } else {
                linkBtn.style.display = 'none';
            }

            // Archive Link
            const archiveBtn = document.getElementById('resArchiveBtn');
            if (t.archiveUrl) {
                archiveBtn.href = t.archiveUrl;
                archiveBtn.style.display = 'block';
            } else {
                archiveBtn.style.display = 'none';
            }

            modal.classList.add('active');
            modal.style.display = 'flex';
        };

        window.closeResModal = () => {
            const modal = document.getElementById('resModal');
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        };
        document.getElementById('resModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('resModal')) window.closeResModal();
        });

        // Load on start
        loadTournaments();
        loadIndexNews();

        async function loadIndexNews() {
            const newsList = document.getElementById('newsList');
            const heroNewsContainer = document.getElementById('heroNewsContainer');

            try {
                const q = query(collection(db, "news"), orderBy("date", "desc"), limit(5));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    if (newsList) newsList.innerHTML = '<div style="padding:20px; text-align:center; color:#a0aec0;">お知らせはありません</div>';
                    return;
                }

                const news = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Hero News (Latest 1)
                const latest = news[0];
                if (latest && heroNewsContainer) {
                    let badgeClass = 'badge-info';
                    let badgeText = 'News';
                    if (latest.type === 'tournament') { badgeClass = 'status-upcoming'; badgeText = '大会情報'; }
                    else if (latest.badge === 'important') { badgeClass = 'badge-important'; badgeText = '重要'; }
                    else if (latest.badge === 'recruit') { badgeClass = 'badge-recruit'; badgeText = '募集'; }
                    else if (latest.badge === 'penalty') { badgeClass = 'badge-important'; badgeText = 'Penalty'; }

                    heroNewsContainer.innerHTML = `
                    <a href="news_detail.html?id=${latest.id}" class="news-card-hero">
                        <span class="badge-news-hero">${badgeText}</span>
                        <span style="color:#cbd5e0; font-family:var(--f-eng); font-size:0.85rem;">${latest.date.replace(/-/g, '.')}</span>
                        <span class="news-hero-title">${latest.title}</span>
                    </a>
                    `;
                }

                // List
                if (newsList) {
                    let html = '';
                    news.forEach(n => {
                        let badgeClass = 'badge-info';
                        let badgeText = 'お知らせ';
                        if (n.type === 'tournament') { badgeClass = 'status-upcoming'; badgeText = '大会情報'; }
                        else if (n.badge === 'important') { badgeClass = 'badge-important'; badgeText = '重要'; }
                        else if (n.badge === 'recruit') { badgeClass = 'badge-recruit'; badgeText = '運営募集'; }
                        else if (n.badge === 'penalty') { badgeClass = 'badge-important'; badgeText = 'ペナルティ'; }
                        else { badgeText = n.badge ? n.badge.toUpperCase() : 'INFO'; }

                        html += `
                        <a href="news_detail.html?id=${n.id}" class="news-item">
                            <div class="news-meta">
                                <span class="news-date">${n.date.replace(/-/g, '.')}</span>
                                <span class="news-cat">${badgeText}</span>
                            </div>
                            <div class="news-item-title">${n.title}</div>
                        </a>
                        `;
                    });
                    newsList.innerHTML = html;
                }

            } catch (e) { console.error('News load error', e); }
        }
    </script>
    <script>
        const hamBtn = document.getElementById('hamBtn');
        const mobMenu = document.getElementById('mobMenu');
        const closeMob = document.getElementById('closeMob');
        hamBtn.addEventListener('click', () => mobMenu.style.display = 'flex');
        closeMob.addEventListener('click', () => mobMenu.style.display = 'none');
        document.querySelectorAll('#mobMenu a').forEach(l => l.addEventListener('click', () => mobMenu.style.display = 'none'));

        // CTA Visibility
        const ctaBar = document.getElementById('ctaBar');
        const footer = document.getElementById('footer');
        const hero = document.querySelector('.hero') || document.querySelector('.hero-container') || document.body.firstElementChild; // .heroがない場合のフォールバック

        let isHeroVisible = true;
        let isFooterVisible = false;

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.target === hero) {
                    isHeroVisible = entry.isIntersecting;
                }
                if (entry.target === footer) {
                    isFooterVisible = entry.isIntersecting;
                }
            });

            // HeroまたはFooterが見えているときは隠す
            if (isHeroVisible || isFooterVisible) {
                ctaBar.classList.add('hidden');
            } else {
                ctaBar.classList.remove('hidden');
            }
        }, { threshold: 0.1 });

        if (footer) observer.observe(footer);
        if (hero) observer.observe(hero);
    </script>
</body>

</html>