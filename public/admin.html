<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運営ダッシュボード | 大学杯</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <div id="loader" class="loading-mask u-hidden">Processing...</div>

    <!-- 1. ログイン画面 -->
    <div id="loginView" class="login-wrapper">
        <div class="card login-card">
            <h1 class="login-title">運営ダッシュボード</h1>
            <p class="u-mb-20 u-text-sm">管理用パスワードを入力してください</p>
            <div id="loginArea">
                <button id="btnLoginDiscord" class="btn"
                    style="background-color: #5865F2; width: 100%; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1892.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.1023.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.419-2.1568 2.419zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.419-2.1568 2.419z" />
                    </svg>
                    Discordでログイン
                </button>
            </div>
            <p id="loginMsg" class="u-text-red u-mt-10 u-text-xs"></p>
        </div>
    </div>

    <!-- 2. ダッシュボード画面 -->
    <div id="dashView" class="dashboard-wrapper u-hidden">
        <div class="u-flex u-gap-10 u-mb-20">
            <!-- onclick removed, IDs used -->
            <button class="tab-btn is-active" id="tabBtnTour">大会管理</button>
            <button class="tab-btn" id="tabBtnNews">お知らせ管理</button>
        </div>

        <!-- 大会タブ -->
        <div id="panelTour">
            <div class="dash-header">
                <div>
                    <h2>大会データ管理</h2>
                    <div class="u-text-xs u-text-gray">DB: tournaments</div>
                </div>
                <button class="btn btn-green" id="btnNew">＋ 新規大会作成</button>
            </div>
            <div class="tournament-list" id="tList">
                <!-- JS injected -->
            </div>
        </div>

        <!-- ニュースタブ -->
        <div id="panelNews" class="u-hidden">
            <div class="dash-header">
                <div>
                    <h2>お知らせ管理</h2>
                    <div class="u-text-xs u-text-gray">DB: news</div>
                </div>
                <button class="btn btn-green" id="btnNewNews">＋ お知らせ作成</button>
            </div>
            <div class="tournament-list" id="nList">
                <!-- JS injected -->
            </div>
        </div>
    </div>

    <!-- 編集モーダル -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle" class="u-mb-20">大会情報の編集</h2>
            <form id="editForm">
                <input type="hidden" id="editId">

                <div class="modal-grid">
                    <!-- カラム 1: 基本情報 -->
                    <div>
                        <div class="section-label">基本情報</div>
                        <label class="form-label-bold">大会名</label>
                        <input type="text" id="inpTourName" placeholder="第n回 大学杯">

                        <div class="u-flex u-gap-10">
                            <div class="u-flex-1">
                                <label class="form-label-bold">大会ステータス</label>
                                <select id="inpStatus">
                                    <option value="upcoming">開催予定</option>
                                    <option value="open">エントリー受付中</option>
                                    <option value="closed">終了</option>
                                </select>
                            </div>
                            <div class="u-flex-1">
                                <label class="form-label-bold">開催日</label>
                                <input type="datetime-local" id="inpEventDate">
                            </div>
                        </div>

                        <label class="form-label-bold">エントリー期間</label>
                        <div class="u-flex u-gap-5 u-items-center u-mb-20">
                            <input type="datetime-local" id="inpEntryStart" class="u-mb-0">
                            <span>~</span>
                            <input type="datetime-local" id="inpEntryEnd" class="u-mb-0">
                        </div>

                        <label class="form-label-bold">大会概要URL</label>
                        <input type="url" id="inpRulesUrl" placeholder="https://docs.google.com/...">

                        <label class="form-label-bold">タイカイサポートリンク</label>
                        <input type="url" id="inpSupportUrl" placeholder="https://...">

                        <div class="section-label">ルール設定</div>
                        <label class="form-label-bold">採用ルール</label>
                        <div class="checkbox-group" id="ruleGroup"></div>

                        <label class="form-label-bold">ステージ制限</label>
                        <div class="stage-grid" id="stageGroup"></div>


                    </div>

                    <!-- カラム 2: 詳細設定 & キャスト -->
                    <div>
                        <div class="section-label">参加条件・XP</div>
                        <label class="form-label-bold">エントリータイプ</label>
                        <select id="inpEntryType">
                            <option value="circle_only">同一サークル限定</option>
                            <option value="cross_ok">クロスサークルOK</option>
                            <option value="invite">サークル選抜</option>
                        </select>

                        <fieldset class="u-mt-10">
                            <legend>XP制限</legend>
                            <label class="checkbox-label u-mb-10">
                                <input type="checkbox" id="chkXpNone"> 制限なし
                            </label>
                            <div id="xpInputs" class="u-flex u-gap-10">
                                <div class="u-flex-1">
                                    <label class="form-label-bold">平均上限</label>
                                    <input type="number" id="inpXpAvg" placeholder="2200">
                                </div>
                                <div class="u-flex-1">
                                    <label class="form-label-bold">最高上限</label>
                                    <input type="number" id="inpXpMax" placeholder="2400">
                                </div>
                            </div>
                        </fieldset>

                        <div class="section-label">キャスト・配信</div>

                        <!-- 実況 -->
                        <div class="box-light">
                            <label class="form-label-bold">実況 (Caster)</label>
                            <input type="text" id="inpCasterName" placeholder="名前">
                            <input type="url" id="inpCasterIcon" placeholder="アイコンURL">
                            <div class="u-flex u-gap-5">
                                <input type="text" id="inpCasterX" placeholder="@..." class="u-flex-1">
                                <input type="url" id="inpCasterYt" placeholder="https://youtube.com/..."
                                    class="u-flex-1">
                            </div>
                        </div>

                        <!-- 解説 -->
                        <div class="box-light">
                            <label class="form-label-bold">解説 (Commentator)</label>
                            <input type="text" id="inpComName" placeholder="名前">
                            <input type="url" id="inpComIcon" placeholder="アイコンURL">
                            <div class="u-flex u-gap-5">
                                <input type="text" id="inpComX" placeholder="@..." class="u-flex-1">
                                <input type="url" id="inpComYt" placeholder="https://youtube.com/..." class="u-flex-1">
                            </div>
                        </div>

                        <label class="form-label-bold">配信担当</label>
                        <input type="text" id="inpOperator" placeholder="担当者">

                        <label class="form-label-bold">任天堂許諾番号</label>
                        <input type="text" id="inpLicense" placeholder="NJ...">
                    </div>
                </div>

                <!-- 結果・アーカイブセクション -->
                <div class="section-label u-mt-20">結果・アーカイブ</div>
                <label class="form-label-bold">優勝チーム名</label>
                <input type="text" id="inpWinTeam">

                <div class="u-flex u-gap-10 u-mb-5">
                    <div class="u-flex-1">
                        <input type="text" id="inpWinUniv" placeholder="大学名1" class="u-mb-5 u-w-full">
                        <input type="text" id="inpWinCircle" placeholder="サークル名1" class="u-w-full u-mb-0">
                    </div>
                    <div id="grpWinDual" class="u-flex-1 u-hidden">
                        <input type="text" id="inpWinUniv2" placeholder="大学名2" class="u-mb-5 u-w-full">
                        <input type="text" id="inpWinCircle2" placeholder="サークル名2" class="u-w-full u-mb-0">
                    </div>
                </div>

                <label class="form-label-bold u-mt-10">優勝メンバー (4名)</label>
                <div class="modal-grid u-gap-10">
                    <input type="text" id="inpWinMem1" placeholder="メンバー1">
                    <input type="text" id="inpWinMem2" placeholder="メンバー2">
                    <input type="text" id="inpWinMem3" placeholder="メンバー3">
                    <input type="text" id="inpWinMem4" placeholder="メンバー4">
                </div>

                <label class="form-label-bold">優勝時の画像URL</label>
                <input type="url" id="inpWinImage" placeholder="https://...">
                <label class="form-label-bold">優勝ポストURL</label>
                <input type="url" id="inpWinUrl" placeholder="https://x.com/...">

                <label class="form-label-bold">配信アーカイブURL</label>
                <input type="url" id="inpArchiveUrl" placeholder="https://youtube.com/...">

                <div class="u-flex u-justify-end u-gap-10 u-mt-20">
                    <button type="button" class="btn btn-red" id="btnCloseModal">キャンセル</button>
                    <button type="submit" class="btn btn-green">保存する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ニュースモーダル -->
    <div id="newsModal" class="modal">
        <div class="modal-content" style="max-width:800px;">
            <h2 id="newsModalTitle" class="u-mb-20">お知らせ編集</h2>
            <form id="newsForm">
                <input type="hidden" id="newsId">

                <div class="u-mb-20">
                    <label class="form-label-bold">フォーマット</label>
                    <div class="u-flex u-gap-20 u-mt-5">
                        <label class="u-flex u-items-center u-cursor-pointer">
                            <input type="radio" name="newsType" value="normal" checked>
                            通常フォーマット
                        </label>
                        <label class="u-flex u-items-center u-cursor-pointer">
                            <input type="radio" name="newsType" value="tournament"> 大会フォーマット
                        </label>
                    </div>
                </div>

                <!-- 通常オプション -->
                <div id="newsTypeNormal">
                    <label class="form-label-bold">バッジ選択</label>
                    <select id="inpNewsBadge" class="u-mb-10">
                        <option value="info">お知らせ (Info)</option>
                        <option value="important">重要 (Important)</option>
                        <option value="recruit">運営募集 (Recruit)</option>
                        <option value="penalty">ペナルティ (Penalty)</option>
                    </select>
                </div>

                <!-- 大会オプション -->
                <div id="newsTypeTour" class="box-light u-hidden">
                    <label class="form-label-bold">対象大会</label>
                    <div class="u-flex u-gap-10">
                        <select id="inpNewsTourId" class="u-flex-1">
                            <option value="">大会を選択してください</option>
                        </select>
                        <button type="button" class="btn btn-sm" id="btnGenDraft">下書き生成</button>
                    </div>
                    <p class="u-text-xs u-text-gray u-mt-5">※大会を選択して「下書き生成」を押すと、本文が自動入力されます。</p>
                </div>

                <div>
                    <label class="form-label-bold">タイトル</label>
                    <input type="text" id="inpNewsTitle" placeholder="タイトルを入力" required>
                </div>

                <!-- 日付 -->
                <div class="u-mb-10">
                    <label class="form-label-bold">公開日</label>
                    <input type="date" id="inpNewsDate" required>
                </div>

                <div>
                    <label class="form-label-bold">本文 (Markdown)</label>
                    <div class="u-text-xs u-text-gray u-mb-5">
                        #見出し, -箇条書き, **強調**, __下線__, ~~取消~~, [リンク](URL)
                    </div>
                    <textarea id="inpNewsBody" rows="10" placeholder="お知らせ本文..." required></textarea>
                </div>

                <div class="u-mt-20 u-flex u-justify-end u-gap-10">
                    <button type="button" class="btn btn-red" id="btnCloseNewsModal">キャンセル</button>
                    <button type="submit" class="btn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 重要: type="module" -->
    <script type="module" src="js/admin.js"></script>
</body>

</html>