<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運営ダッシュボード | 大学杯</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <div id="loader" class="loading-mask u-hidden">Processing...</div>

    <!-- 1. ログイン画面 -->
    <div id="loginView" class="login-wrapper">
        <div class="card login-card">
            <h1 class="login-title">運営ダッシュボード</h1>
            <p class="u-mb-20 u-text-sm">管理用パスワードを入力してください</p>
            <form id="loginForm">
                <input type="password" id="adminPass" placeholder="Password" required>
                <button type="submit" class="btn">ログイン</button>
            </form>
            <p id="loginMsg" class="u-text-red u-mt-10 u-text-xs"></p>
        </div>
    </div>

    <!-- 2. ダッシュボード画面 -->
    <div id="dashView" class="dashboard-wrapper u-hidden">
        <div class="u-flex u-gap-10 u-mb-20">
            <button class="tab-btn is-active" id="tabBtnTour" onclick="switchTab('tour')">大会管理</button>
            <button class="tab-btn" id="tabBtnNews" onclick="switchTab('news')">お知らせ管理</button>
        </div>

        <!-- 大会タブ -->
        <div id="panelTour">
            <div class="dash-header">
                <div>
                    <h2>大会データ管理</h2>
                    <div class="u-text-xs u-text-gray">Firestore: tournaments</div>
                </div>
                <button class="btn btn-green" id="btnNew">＋ 新規大会作成</button>
            </div>
            <div class="tournament-list" id="tList">
                <!-- JS injected -->
            </div>
        </div>

        <!-- ニュースタブ -->
        <div id="panelNews" class="u-hidden">
            <div class="dash-header">
                <div>
                    <h2>お知らせ管理</h2>
                    <div class="u-text-xs u-text-gray">Firestore: news</div>
                </div>
                <button class="btn btn-green" id="btnNewNews">＋ お知らせ作成</button>
            </div>
            <div class="tournament-list" id="nList">
                <!-- JS injected -->
            </div>
        </div>
    </div>

    <!-- 編集モーダル -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle" class="u-mb-20">大会情報の編集</h2>
            <form id="editForm">
                <input type="hidden" id="editId">

                <div class="modal-grid">
                    <!-- カラム 1: 基本情報 -->
                    <div>
                        <div class="section-label">基本情報</div>
                        <label class="form-label-bold">大会名</label>
                        <input type="text" id="inpTourName" placeholder="第n回 大学杯">

                        <div class="u-flex u-gap-10">
                            <div class="u-flex-1">
                                <label class="form-label-bold">大会ステータス</label>
                                <select id="inpStatus">
                                    <option value="upcoming">開催予定</option>
                                    <option value="open">エントリー受付中</option>
                                    <option value="closed">終了</option>
                                </select>
                            </div>
                            <div class="u-flex-1">
                                <label class="form-label-bold">開催日</label>
                                <input type="datetime-local" id="inpEventDate">
                            </div>
                        </div>

                        <label class="form-label-bold">エントリー期間</label>
                        <div class="u-flex u-gap-5 u-items-center u-mb-20">
                            <input type="datetime-local" id="inpEntryStart" class="u-mb-0">
                            <span>~</span>
                            <input type="datetime-local" id="inpEntryEnd" class="u-mb-0">
                        </div>

                        <label class="form-label-bold">大会概要URL</label>
                        <input type="url" id="inpRulesUrl" placeholder="https://docs.google.com/...">

                        <label class="form-label-bold">タイカイサポートリンク</label>
                        <input type="url" id="inpSupportUrl" placeholder="https://...">

                        <div class="section-label">ルール設定</div>
                        <label class="form-label-bold">採用ルール</label>
                        <div class="checkbox-group" id="ruleGroup"></div>

                        <label class="form-label-bold">ステージ制限</label>
                        <div class="stage-grid" id="stageGroup"></div>


                    </div>

                    <!-- カラム 2: 詳細設定 & キャスト -->
                    <div>
                        <div class="section-label">参加条件・XP</div>
                        <label class="form-label-bold">エントリータイプ</label>
                        <select id="inpEntryType">
                            <option value="circle_only">同一サークル限定</option>
                            <option value="cross_ok">クロスサークルOK</option>
                            <option value="invite">サークル選抜</option>
                        </select>

                        <fieldset class="u-mt-10">
                            <legend>XP制限</legend>
                            <label class="checkbox-label u-mb-10">
                                <input type="checkbox" id="chkXpNone"> 制限なし
                            </label>
                            <div id="xpInputs" class="u-flex u-gap-10">
                                <div class="u-flex-1">
                                    <label class="form-label-bold">平均上限</label>
                                    <input type="number" id="inpXpAvg" placeholder="2200">
                                </div>
                                <div class="u-flex-1">
                                    <label class="form-label-bold">最高上限</label>
                                    <input type="number" id="inpXpMax" placeholder="2400">
                                </div>
                            </div>
                        </fieldset>

                        <div class="section-label">キャスト・配信</div>

                        <!-- 実況 -->
                        <div class="box-light">
                            <label class="form-label-bold">実況 (Caster)</label>
                            <input type="text" id="inpCasterName" placeholder="名前">
                            <input type="url" id="inpCasterIcon" placeholder="アイコンURL">
                            <div class="u-flex u-gap-5">
                                <input type="text" id="inpCasterX" placeholder="@..." class="u-flex-1">
                                <input type="url" id="inpCasterYt" placeholder="https://youtube.com/..."
                                    class="u-flex-1">
                            </div>
                        </div>

                        <!-- 解説 -->
                        <div class="box-light">
                            <label class="form-label-bold">解説 (Commentator)</label>
                            <input type="text" id="inpComName" placeholder="名前">
                            <input type="url" id="inpComIcon" placeholder="アイコンURL">
                            <div class="u-flex u-gap-5">
                                <input type="text" id="inpComX" placeholder="@..." class="u-flex-1">
                                <input type="url" id="inpComYt" placeholder="https://youtube.com/..." class="u-flex-1">
                            </div>
                        </div>

                        <label class="form-label-bold">配信担当</label>
                        <input type="text" id="inpOperator" placeholder="担当者">

                        <label class="form-label-bold">任天堂許諾番号</label>
                        <input type="text" id="inpLicense" placeholder="NJ...">
                    </div>
                </div>

                <!-- 結果・アーカイブセクション -->
                <div class="section-label u-mt-20">結果・アーカイブ</div>
                <label class="form-label-bold">優勝チーム名</label>
                <input type="text" id="inpWinTeam">

                <div class="u-flex u-gap-10 u-mb-5">
                    <div class="u-flex-1">
                        <input type="text" id="inpWinUniv" placeholder="大学名1" class="u-mb-5 u-w-full">
                        <input type="text" id="inpWinCircle" placeholder="サークル名1" class="u-w-full u-mb-0">
                    </div>
                    <div id="grpWinDual" class="u-flex-1 u-hidden">
                        <input type="text" id="inpWinUniv2" placeholder="大学名2" class="u-mb-5 u-w-full">
                        <input type="text" id="inpWinCircle2" placeholder="サークル名2" class="u-w-full u-mb-0">
                    </div>
                </div>

                <label class="form-label-bold u-mt-10">優勝メンバー (4名)</label>
                <div class="modal-grid u-gap-10">
                    <input type="text" id="inpWinMem1" placeholder="メンバー1">
                    <input type="text" id="inpWinMem2" placeholder="メンバー2">
                    <input type="text" id="inpWinMem3" placeholder="メンバー3">
                    <input type="text" id="inpWinMem4" placeholder="メンバー4">
                </div>

                <label class="form-label-bold">優勝時の画像URL</label>
                <input type="url" id="inpWinImage" placeholder="https://...">
                <label class="form-label-bold">優勝ポストURL</label>
                <input type="url" id="inpWinUrl" placeholder="https://x.com/...">

                <label class="form-label-bold">配信アーカイブURL</label>
                <input type="url" id="inpArchiveUrl" placeholder="https://youtube.com/...">

                <div class="u-flex u-justify-end u-gap-10 u-mt-20">
                    <button type="button" class="btn btn-red" id="btnCloseModal">キャンセル</button>
                    <button type="submit" class="btn btn-green">保存する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ニュースモーダル -->
    <div id="newsModal" class="modal">
        <div class="modal-content" style="max-width:800px;">
            <h2 id="newsModalTitle" class="u-mb-20">お知らせ編集</h2>
            <form id="newsForm">
                <input type="hidden" id="newsId">

                <div class="u-mb-20">
                    <label class="form-label-bold">フォーマット</label>
                    <div class="u-flex u-gap-20 u-mt-5">
                        <label class="u-flex u-items-center u-cursor-pointer">
                            <input type="radio" name="newsType" value="normal" checked onchange="toggleNewsType()">
                            通常フォーマット
                        </label>
                        <label class="u-flex u-items-center u-cursor-pointer">
                            <input type="radio" name="newsType" value="tournament" onchange="toggleNewsType()"> 大会フォーマット
                        </label>
                    </div>
                </div>

                <!-- 通常オプション -->
                <div id="newsTypeNormal">
                    <label class="form-label-bold">バッジ選択</label>
                    <select id="inpNewsBadge" class="u-mb-10">
                        <option value="info">お知らせ (Info)</option>
                        <option value="important">重要 (Important)</option>
                        <option value="recruit">運営募集 (Recruit)</option>
                        <option value="penalty">ペナルティ (Penalty)</option>
                    </select>
                </div>

                <!-- 大会オプション -->
                <div id="newsTypeTour" class="box-light u-hidden">
                    <label class="form-label-bold">対象大会</label>
                    <div class="u-flex u-gap-10">
                        <select id="inpNewsTourId" class="u-flex-1">
                            <option value="">大会を選択してください</option>
                        </select>
                        <button type="button" class="btn btn-sm" onclick="generateDraft()">下書き生成</button>
                    </div>
                    <p class="u-text-xs u-text-gray u-mt-5">※大会を選択して「下書き生成」を押すと、本文が自動入力されます。</p>
                </div>

                <div>
                    <label class="form-label-bold">タイトル</label>
                    <input type="text" id="inpNewsTitle" placeholder="タイトルを入力" required>
                </div>

                <!-- 日付 -->
                <div class="u-mb-10">
                    <label class="form-label-bold">公開日</label>
                    <input type="date" id="inpNewsDate" required>
                </div>

                <div>
                    <label class="form-label-bold">本文 (Markdown)</label>
                    <div class="u-text-xs u-text-gray u-mb-5">
                        #見出し, -箇条書き, **強調**, __下線__, ~~取消~~, [リンク](URL)
                    </div>
                    <textarea id="inpNewsBody" rows="10" placeholder="お知らせ本文..." required></textarea>
                </div>

                <div class="u-mt-20 u-flex u-justify-end u-gap-10">
                    <button type="button" class="btn btn-red" id="btnCloseNewsModal">キャンセル</button>
                    <button type="submit" class="btn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="js/admin.js"></script>
</body>

</html>